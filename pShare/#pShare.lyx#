#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\use_hyperref false
\papersize default
\use_geometry false
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Bridging MOOS Communities with 
\family typewriter
pShare
\family default
 
\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Standard
MOOS-V10 brings with it a new command line application which allows data
 to be shared between MOOS communities.
 Recall that in MOOS parlance a 
\begin_inset Quotes eld
\end_inset

community
\begin_inset Quotes erd
\end_inset

is a the set of programms talking to a particular instance of a 
\family typewriter
MOOSDB
\family default
 including the 
\family typewriter
MOOSDB
\family default
 itself.
 In some ways 
\family typewriter
pShare
\family default
 is just a modern, better written version of 
\family typewriter
pMOOSBridge
\family default
 in others it offers much greater flexibility and functionality.
 Here is a quick summary of 
\family typewriter
pShare
\family default
 functionality
\end_layout

\begin_layout Itemize
Offers UDP communication between communities
\end_layout

\begin_layout Itemize
Can share data over multicast channels
\end_layout

\begin_layout Itemize
Supports wildcard forwarding and renaming of variable
\end_layout

\begin_layout Itemize
Supports dynamic configuration (via MOOS) of sharing/forwarding/renaming
\end_layout

\begin_layout Itemize
Supports command line configuration and from a .moos file
\end_layout

\begin_layout Standard
It is worth, straight off the bat, understanding how in usage terms 
\family typewriter
pShare
\family default
 is different from 
\family typewriter
pMOOSBridge
\end_layout

\begin_layout Itemize

\family typewriter
pShare
\family default
 unlike 
\family typewriter
pMOOSBridge
\family default
 only supports UDP (or multicast which is a kind of UDP)
\end_layout

\begin_layout Itemize
You need one instance of pShare per community (compare this to 
\family typewriter
pMOOSBridge
\family default
 where a single instance could be used to bridge any number of communities)
\end_layout

\begin_layout Itemize
Currently 
\family typewriter
pShare
\family default
 only supports sharing of up to 64K messages
\end_layout

\begin_layout Subsection
Why UDP ?
\end_layout

\begin_layout Standard
UDP is, of course, a lossy affair - there is no guarrantee that messages
 will get through and indeed 
\family typewriter
pShare
\family default
 is intended for use in just such situations.
 Use 
\family typewriter
pShare
\family default
 when you want, when possible, to get messages between communities but you
 don't mind dropping a few messages.
 Perhaps this applies when you have a deployed robot out in the wilds and
 the wireless link simply doesn't suport tcp/ip as well as you might hope.
 
\begin_inset Foot
status open

\begin_layout Plain Layout
If you do mind loosing things then you must use tcp/ip (standard MOOS) and
 if you have a lossy connection you will spend years waiting for data.
\end_layout

\end_inset


\end_layout

\begin_layout Section
Basic Operation
\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:A-simple-use"

\end_inset

 shows a typical and simple use case of 
\family typewriter
pShare.
 
\family default
Here two communities are linked by two instances of 
\family typewriter
pShare.
 
\family default
Each is connected to a MOOSDB and each pShare is configured (by a means
 we will get to in a minute) to subscribe to messages from the 
\family typewriter
MOOSDB
\family default
 (issued by clients).
 These messages are forwarded over a udp link to the other 
\family typewriter
pShare
\family default
 instance which inserts them into it's own 
\family typewriter
MOOSDB.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/SimpleShare.pdf
	width 80col%

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
A simple use of 
\family typewriter
pShare: 
\family default
two communities are linked by two instances of pShare - one in each community.
\begin_inset CommandInset label
LatexCommand label
name "fig:A-simple-use"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
A more complicated (marginally) example is show in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:multi-share"

\end_inset

 .
 Here the left hand community is sharing as an output data to the top right
 and bottom right communities but only receiving data from the bottom right.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/MultipleShare.pdf
	width 80col%

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
A simple use of 
\family typewriter
pShare: 
\family default
two communities are linked by two instances of pShare - one in each community.
\begin_inset CommandInset label
LatexCommand label
name "fig:multi-share"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Configuring Sharing
\end_layout

\begin_layout Standard
Each instance of 
\family typewriter
pShare
\family default
 can be configured to such that it can
\end_layout

\begin_layout Itemize
forward a named message (like 'X') toany number of specific udp ports on
 any number of machines
\end_layout

\begin_layout Itemize
can rename a message before forwarding
\end_layout

\begin_layout Itemize
receive and forward on to its own 
\family typewriter
MOOSDB
\family default
 messages from any number of other 
\family typewriter
pShares
\end_layout

\begin_layout Itemize
forward messages on predefined or any number of user defined multicast channel
 
\end_layout

\begin_layout Itemize
receive messages on any number of multicast channels
\end_layout

\begin_layout Standard
how to do this is best explained with some examples and that will happen
 in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Example-Configurations"

\end_inset

.
 Before that it is worth explaining the merit of multicast channels.
\end_layout

\begin_layout Subsubsection
Multicast Channels
\end_layout

\begin_layout Standard
Imagine you as an application developer knew that other communities (but
 you do not know which ones 
\emph on
a-priori
\emph default
) would be interested in a variable called 
\family typewriter
X.
 
\family default
Now if you knew exactly who wanted it you could configure a standard UDP
 shares to mutually agreed ports (presumably one port per community) on
 which other 
\family typewriter
pShares
\family default
 are listening.
 But you don't.
 So what to do? Well you could use 
\family typewriter
pShare's
\family default
 ability for packets to predefine multicast channels ( these are really
 simply multicast addresses behind the scenes) you can tell pShare to forward
 MOOS messages out to a multicast_channel and later on any number of other
 
\family typewriter
pShare
\family default
 instances can subscribe to this channel and receive them.
\end_layout

\begin_layout Subsubsection
Example Commandline Configurations
\begin_inset CommandInset label
LatexCommand label
name "sub:Example-Configurations"

\end_inset


\end_layout

\begin_layout Standard
Imagine we have two communities A and B.
 Lets also assume that they reside on different machines.
 Machine A has ip address 192.168.0.10 and machine B has ip address 192.168.0.11.
 Lets have 
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="12" columns="3">
<features tabularvalignment="middle">
<column alignment="left" valignment="top" width="4cm">
<column alignment="left" valignment="top" width="0">
<column alignment="left" valignment="top" width="0">
<row>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
description
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
terminal A command line
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
terminal B command line
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
share X from A to B
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
 -o='X->192.168.0.4:10000:udp' 
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=localhost:10000
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
share X from A to B as Y
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
 -o='X->Y:192.168.0.4:10000:udp'
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=localhost:10000
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
share X from A to B as X and Y
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-o='X->92.168.0.4:10000:udp & Y:192.168.0.4:10000:udp'
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=localhost:10000
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
share X from A to B as X and Y via two different ports
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-o='X->92.168.0.4:10000:udp & Y:192.168.0.4:20000:udp'
\end_layout

\end_inset
</cell>
<cell alignment="left" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=localhost:10000,localhost:20000
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
share X and Y to B
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-o='X->192.168.0.4:10000:udp , Y->192.168.0.4:10000:udp'
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=localhost:10000
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
share X via multicast
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-o='X->multicast_7' 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=multicast_7
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
share X via multicast and rename
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-o='X->Y:multicast_7' 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=multicast_7
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
share X on several channels
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-o='X->Y:multicast_7 & Z:multicast_3' 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=multicast_7,multicast_3
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
share X as several new variables on the same multicast channel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-o='X->Y:multicast_7 & Z:multicast_7' 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size footnotesize
-i=multicast_7
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Subsubsection
The form of command line configuration strings
\end_layout

\begin_layout Standard
The '-o' switch allows you to configure which messages to forward, how to
 rename them and where to send them.
 At its highest level the the '-o' switch is followed by a comma separated
 list of mappings: 
\begin_inset Quotes eld
\end_inset


\family typewriter
-o= mapping , mapping, mapping,..
\family default
.
\begin_inset Quotes erd
\end_inset

 and each mapping describes how one MOOS variable is routed to any number
 of destinations.
 Each mapping has the form of 
\begin_inset Quotes eld
\end_inset


\family typewriter
var_name->route & route...
\family default

\begin_inset Quotes erd
\end_inset

 so a ampersand separated list of 
\begin_inset Quotes eld
\end_inset

routes
\begin_inset Quotes erd
\end_inset

.
 Each route describes a destination for a message and it has the format
 new_name:destination_address:destination_port:udp or new_name:multicast_channel
\end_layout

\begin_layout Standard

\series bold
\begin_inset Box Shadowbox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\series bold
Tip: 
\series default
don't forget to put single quotes around the routing directives to prevent
 your shell from interpretting the '>' character.
\end_layout

\end_inset


\end_layout

\end_body
\end_document
